name: KiroZozo Movie Extractor

on:
  workflow_dispatch:
    inputs:
      script:
        description: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù Ù„ØªØ´ØºÙŠÙ„Ù‡'
        required: false
        default: 'both'
        type: choice
        options:
        - fetch.js
        - fetch_daily.js
        - both
  schedule:
    - cron: "*/300 * * * *"  # ÙƒÙ„ 100 Ø¯Ù‚ÙŠÙ‚Ø©
    - cron: "*/10000 * * * *"  # ÙƒÙ„ 300 Ø¯Ù‚ÙŠÙ‚Ø©

jobs:
  extract-movies:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: |
          npm install jsdom
          echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…"

      - name: Determine which script to run
        id: script-selector
        run: |
          SCRIPT_TO_RUN=""
          
          # Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… input
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            SCRIPT_TO_RUN="${{ github.event.inputs.script }}"
          
          # Ø¥Ø°Ø§ ÙƒØ§Ù† cron 300 Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø´ØºÙ„ fetch.js
          elif [ "${{ github.event.schedule }}" == '*/300 * * * *' ]; then
            SCRIPT_TO_RUN="fetch.js"
          
          # Ø¥Ø°Ø§ ÙƒØ§Ù† cron 100 Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø´ØºÙ„ fetch_daily.js
          elif [ "${{ github.event.schedule }}" == '*/100 * * * *' ]; then
            SCRIPT_TO_RUN="fetch_daily.js"
          fi
          
          echo "ğŸ”§ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ø¯Ø¯: $SCRIPT_TO_RUN"
          echo "::set-output name=script::$SCRIPT_TO_RUN"

      - name: Run the selected script
        run: |
          echo "ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„..."
          echo "ğŸ“… Ø§Ù„ÙˆÙ‚Øª: $(date)"
          echo "ğŸ“ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ø¯Ø¯: ${{ steps.script-selector.outputs.script }}"
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù/Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
          case "${{ steps.script-selector.outputs.script }}" in
            "fetch.js")
              echo "ğŸ”„ ØªØ´ØºÙŠÙ„ fetch.js..."
              node fetch.js
              ;;
            "fetch_daily.js")
              echo "ğŸ”„ ØªØ´ØºÙŠÙ„ fetch_daily.js..."
              node fetch_daily.js
              ;;
            "both")
              echo "ğŸ”„ ØªØ´ØºÙŠÙ„ fetch.js Ø£ÙˆÙ„Ø§Ù‹..."
              node fetch.js
              echo "â³ Ø§Ù†ØªØ¸Ø§Ø± 10 Ø«ÙˆØ§Ù†ÙŠ..."
              sleep 10
              echo "ğŸ”„ ØªØ´ØºÙŠÙ„ fetch_daily.js Ø«Ø§Ù†ÙŠØ§Ù‹..."
              node fetch_daily.js
              ;;
            *)
              echo "âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ù„Ù ØµØ§Ù„Ø­"
              ;;
          esac
          
          echo "âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„"

      # Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ù†ÙØ³Ù‡Ø§...
