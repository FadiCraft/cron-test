name: Simple Movie Fetcher

on:
  workflow_dispatch:
  schedule:
    - cron: "*/10 * * * *"  # ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Create simple script
        run: |
          cat > fetch.js << 'EOF'
          import fs from "fs";
          import { JSDOM } from "jsdom";
          
          async function main() {
              console.log("ğŸ¬ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙÙ„Ø§Ù…...");
              
              try {
                  // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch Ø§Ù„Ù…Ø¯Ù…Ø¬ ÙÙŠ Node 18
                  const response = await fetch("https://topcinema.media/movies/", {
                      headers: { 'User-Agent': 'Mozilla/5.0' }
                  });
                  
                  if (response.ok) {
                      const html = await response.text();
                      const dom = new JSDOM(html);
                      const movies = [];
                      
                      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                      const titles = dom.window.document.querySelectorAll('.title');
                      titles.forEach((title, i) => {
                          if (i < 6) {
                              movies.push({
                                  id: i + 1,
                                  title: title.textContent.trim(),
                                  fetchedAt: new Date().toISOString()
                              });
                          }
                      });
                      
                      console.log(`âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${movies.length} ÙÙŠÙ„Ù…`);
                      return movies;
                  }
              } catch (error) {
                  console.log("âš ï¸ Ø®Ø·Ø£:", error.message);
              }
              
              // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
              return [
                  { id: 1, title: "ÙÙŠÙ„Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ 1", fetchedAt: new Date().toISOString() },
                  { id: 2, title: "ÙÙŠÙ„Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ 2", fetchedAt: new Date().toISOString() }
              ];
          }
          
          main().then(movies => {
              const result = {
                  timestamp: new Date().toISOString(),
                  movies: movies,
                  total: movies.length
              };
              
              fs.writeFileSync("result.json", JSON.stringify(result, null, 2));
              console.log("ğŸ“ ØªÙ… Ø­ÙØ¸ result.json");
          });
          EOF
          
          # ØªØ´ØºÙŠÙ„
          node fetch.js

      - name: Display results
        run: |
          echo "ğŸ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:"
          ls -la *.json
          echo ""
          echo "ğŸ“‹ Ù…Ø­ØªÙˆÙ‰ result.json:"
          cat result.json || echo "Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
