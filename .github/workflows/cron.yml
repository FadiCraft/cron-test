name: KiroZozo Movie Fetcher

on:
  workflow_dispatch:  # Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙŠØ¯ÙˆÙŠ
  schedule:
    - cron: "0 */2 * * *"  # ÙƒÙ„ Ø³Ø§Ø¹ØªÙŠÙ†
    - cron: "0 12 * * *"    # ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹

jobs:
  fetch-movies:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Run movie fetcher
        run: node fetch.js
        timeout-minutes: 10

      - name: Show results
        run: |
          echo "=== Extracted Data ==="
          cat result.json | jq '.stats'

      - name: Commit and push changes
        run: |
          git config --local user.name "GitHub Action"
          git config --local user.email "action@github.com"
          git add result.json movies.json series.json
          git commit -m "ğŸ”´ Updated movie data - $(date +'%Y-%m-%d %H:%M')" || echo "No changes to commit"
          git push
