name: KiroZozo Series Extractor (Normal Series Only)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 2 * * *"

jobs:
  extract-series:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: |
          npm init -y
          npm install jsdom
          echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…"

      - name: Create necessary directories
        run: |
          mkdir -p Series/agseries/TV_Series
          mkdir -p Series/agseries/Seasons
          mkdir -p Series/agseries/Episodes
          echo "ğŸ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†"

      - name: Run the series scraper
        run: |
          echo "ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©..."
          echo "ğŸ“… Ø§Ù„ÙˆÙ‚Øª: $(date)"
          echo "ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: https://topcinema.rip/category/%d9%84%d8%b3%d0%b4%d8%a7%d8%aa-%d8%a7%d8%ac%d9%86%d8%a9/"
          node daily_Series.js
          echo "âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª"

      - name: Configure Git
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

      - name: Pull latest changes
        run: |
          git pull origin main --rebase || echo "âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø³Ø­Ø¨"

      - name: Add and commit changes
        run: |
          git add Series/ daily_Series.js || echo "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©"
          
          if git diff --cached --quiet; then
            echo "ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø±ÙØ¹"
          else
            git commit -m "ğŸ“º ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© - $(date +'%Y-%m-%d %H:%M')" -m "ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹"
            echo "âœ… ØªÙ… commit Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"
          fi

      - name: Push changes
        run: |
          if git log origin/main..HEAD --oneline | grep -q .; then
            echo "ğŸ”¼ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª..."
            git push origin main
            echo "âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"
          else
            echo "ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø±ÙØ¹"
          fi
