name: رمضان 2026

on:
  schedule:
    - cron: '0 2 * * *'  # يومياً الساعة 2 صباحاً
  workflow_dispatch:
    inputs:
      url:
        description: 'URL to extract from'
        required: false
        default: 'https://z.larooza.life/category.php?cat=ramadan-2026'

jobs:
  extract:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        npm install node-html-parser
        
    - name: Create package.json
      run: |
        echo '{
          "name": "larooza-extractor",
          "version": "1.0.0",
          "description": "Extract episodes from Larooza website",
          "main": "extract-episodes.js",
          "scripts": {
            "start": "node extract-episodes.js",
            "extract": "node extract-episodes.js"
          },
          "dependencies": {
            "node-html-parser": "^6.1.5"
          },
          "keywords": ["scraper", "episodes", "larooza"],
          "author": "",
          "license": "MIT"
        }' > package.json
        
    - name: Run extractor
      run: npm run extract ${{ github.event.inputs.url }}
      continue-on-error: true
      
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add Ramadan/ || echo "No Ramadan folder"
        git commit -m "Update episodes $(date '+%Y-%m-%d %H:%M')" || echo "No changes to commit"
        git push || echo "Push failed"
